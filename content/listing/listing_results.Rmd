---
title: "Census survey"
author: "Mihir Bhaskar"
output: html_document
weight: 10
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(message = FALSE)

# Clear workspace
rm(list = ls())

# Load packages (easy loading through pacman)
pacman::p_load(tidyverse, sp, leaflet, rgdal, maptools, tmap, stringr, ggthemes, knitr, ggmap)

# Creating easy table function for displaying using kable
tab <- function(x, y){
  
  y <- enquo(y)
  
  x %>% group_by(!!y) %>% summarise(n = n()) %>%
    
    mutate(percent = round((n/sum(n)), 3)) %>% arrange(desc(n))
  
}

# Setting Google API key for base maps
api_key <- "AIzaSyAUMxyqhKjoFITUEEESgXVQojItbVBzDus"
register_google(key = api_key)

#### Importing data and basic processing for analysis ####

# Import listing hh data
hh <- as.data.frame(read.csv('D:/Dropbox/Mayur Vihar Project/full_master_hh_data.csv')) 

# Import listing individual data
ind <- as.data.frame(read.csv('D:/Dropbox/Mayur Vihar Project/full_master_ind_data.csv')) 

# Import boundary shapefile, drawn using Google Maps and exported as .kml
boundaries <- readOGR("D:/Dropbox/Mayur Vihar Project/Listing Survey/Data/Raw/Blocks for listing.kml",
                      require_geomType='wkbPolygon')

# Dropping cases without HHID (basically cases that were found in the net distribution but didn't match)
hh <- hh[hh$hhid != "",]
hh <- hh[hh$consent == "Yes",]
ind <- ind[ind$consent == "Yes",]

# Creating age categories
ind$age_group <- cut(ind$age, breaks = c(0,5,18,30,45,65,150), right = FALSE,
                     labels = c('Under 5','5-17 years', '18-29 years', '30-44 years', 
                                '45-64 years', '65 and above'))

ind$under_18 <- as.factor(ind[,'age'] >= 18)
levels(ind$under_18) <- c('Under 18 years','Above 18 years')

# Re-leveling length of stay var
hh$length_of_stay <- factor(hh$length_of_stay, levels = 
                              c("","Keep coming and going","0 to 1 year","1 to 5 years",
                                "5 to 10 years","10 to 20 years","20 years or more"))

ind$length_of_stay <- factor(ind$length_of_stay, levels = 
                              c("","Keep coming and going","0 to 1 year","1 to 5 years",
                                "5 to 10 years","10 to 20 years","20 years or more"))

# Creating education categories
ind$edu_group <- cut(ind$edu_level, c(-100,-87,4,9,11,12,15,18),
                     labels = c('Did not know or respond','Below primary/no formal education',
                                'Completed primary','10th pass','12th pass','Completed degree/diploma','Others'), right = TRUE) 

ind$edu_group[ind$edu_level == 16] <- 'Below primary/no formal education' # Anganwadi/nursery school reclassifying

ind$edu_group[ind$edu_level == 17] <- 'Below primary/no formal education' # Home schooled


```

## Motivation

We decided that if we were going to work with a community, it was important to:

1. Define the boundaries clearly and get a sense of the total number of individuals and households living within these boundaries. This would in-turn help in the planning and logistics of any sub-project by answering questions like: "How many mosquito nets should we procure?"

2. Understand some socio-demographic characteristics to help brainstorm and target the most useful interventions. For example, finding out if the community primarily comprises of young men living alone or of full families would inform a very different set of interventions. 

## What we did

We designed and conducted a **short survey** intended to capture basic details about **every household** living within the defined boundaries. You can see these boundaries on the homepage.

Our local coordinator, Vikram, identified and trained 12 surveyors to go door-to-door and fill out a digital form using SurveyCTO on their smartphones. You can view the form [**here**](https://mayurvihar.surveycto.com/collect/listing_v1?caseid=). 

The survey ran from 10th to 18th July, 2020 and covered `r nrow(hh)` households. Results from this data are presented below.

Before proceeding, it's worth flagging a few caveats and challenges faced during this exercise:

- Coverage: While the survey was conducted after the nationwide Covid-19 lockdown was lifted, several migrant households in the community that had travelled to their native villages had not returned. Our local coordinator believes there are approximately 200 households like this, and it is unclear how many will return in the coming months. 

- Data quality: The surveyors had no prior digital data collection experience. While the survey was simple, there is a possibility that huts were missed or minor errors crept into data collection, particularly for tricky questions such as identifying who counts as a household member. While surveyors were monitored closely during data collection, conducting back-checks on the data was outside the scope of this activity and so it is tough to quantify the magnitude of such errors. *That said, we remain confident that the data is good enough to meet the purposes laid out above.*

## Demographics and basic household profile

In total, we found `r nrow(hh)` households, totalling `r sum(hh$hh_size, na.rm = TRUE)` individuals. The map below shows the spatial distribution of households; there appear to be a few clear clusters closer to the Noida Link Road and Mayur Vihar-1, with density decreasing closer to the river bank.

It is significant that this is a community of "squatters"; that is, the [land is owned by the Delhi Development Authority](https://www.hindustantimes.com/cities/dda-demolishes-hundreds-of-hutments-on-yamuna-floodplain/story-x105Sl8yPf2tLgUFM0XLRK.html), and its proximity to the riverbed does not allow in-situ development of permanent housing. Most households live in huts or shacks, as you will notice in the pictures on the home page.

```{r fullmap}

# Creating map showing HH distribution of points
boundariesdta <- fortify(boundaries)

qmplot(data = hh[hh$location_accuracy < 20,], x = longitude, y = latitude) +
  stat_density2d(aes(fill = ..level..), bins = 30, size = 0.01, geom = "polygon", alpha = 0.1) 

```

In spite of this, a large majority of those living here are living as families. The average household size is `r mean(hh$hh_size, na.rm = TRUE) %>% round(digits = 1)` members, with only `r nrow(hh[hh$hh_size == 1,])` single-member households. 

This point is re-iterated when we observe the age distribution of individuals; **`r round(100*sum(ind$age < 18)/length(ind$age), digits = 1)`% of individuals are under the age of 18!**


```{r hhsize}

# Household size distribution
ggplot(hh, aes(x = hh_size)) + 
  geom_bar(fill = 'lightblue3', color = 'navyblue') + 
  geom_vline(xintercept = mean(hh$hh_size, na.rm = TRUE), size = 0.5) + 
  scale_x_continuous(breaks=1:10, labels = 1:10)+
  ylab('Number of households') + xlab('') +
  theme(panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  ggtitle("Distribution of household size (number of members)")

```


## Forthcoming analysis

- Distribution of education levels
- Access to services, and therefore access to basic government schemes (phone, bank accounts, ration card, Aadhaar card, voter ID)
- And more!



